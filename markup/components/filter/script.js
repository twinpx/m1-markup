!function(u){"use strict";u(function(){u("#filter").data({Filter:new function(){var a=this;function e(){l(),a.$reset.click(function(){r({rooms:[a.$rooms.slider("option","min"),a.$rooms.slider("option","max")],floors:[a.$floors.slider("option","min"),a.$floors.slider("option","max")],square:[a.$square.slider("option","min"),a.$square.slider("option","max")],price:[a.$price.slider("option","min"),a.$price.slider("option","max")]})}),a.$filter.delegate("tbody tr","click",function(){var e=u(this);window.location=e.data("url")})}function r(e){u("#filter-rooms").slider("values",0,e.rooms[0]),u("#filter-rooms").slider("values",1,e.rooms[1]),u("#filter-rooms .ui-slider-handle:eq(0) span").text(e.rooms[0]),u("#filter-rooms .ui-slider-handle:eq(1) span").text(e.rooms[1]),u("#filter-floors").slider("values",0,e.floors[0]),u("#filter-floors").slider("values",1,e.floors[1]),u("#filter-floors .ui-slider-handle:eq(0) span").text(e.floors[0]),u("#filter-floors .ui-slider-handle:eq(1) span").text(e.floors[1]),u("#filter-square").slider("values",0,e.square[0]),u("#filter-square").slider("values",1,e.square[1]),u("#filter-square .ui-slider-handle:eq(0) span").text(e.square[0]),u("#filter-square .ui-slider-handle:eq(1) span").text(e.square[1]),u("#filter-price").slider("values",0,e.price[0]),u("#filter-price").slider("values",1,e.price[1]),u("#filter-price-value").text(e.price[0]+" — "+e.price[1]+" руб."),n()}function o(r){var l=1e15,i=0;return a.flatsArray.forEach(function(e){1*e[r]&&1*e[r]>i&&(i=1*e[r]),1*e[r]&&1*e[r]<l&&(l=1*e[r])}),1e15===l&&0===i&&(l=0,i=10),[l,i]}function l(){u.ajax({url:a.$tbody.data("json"),type:a.$tbody.data("method"),dataType:"json",success:function(e){var l,i,t,s;a.flatsArray=e,l=o("FlatRoomsCount"),a.$rooms.slider({range:!0,min:l[0],max:l[1],values:[l[0],l[1]],create:function(e,r){u("#filter-rooms .ui-slider-handle:eq(0)").append("<span>"+l[0]+"</span>"),u("#filter-rooms .ui-slider-handle:eq(1)").append("<span>"+l[1]+"</span>")},slide:function(e,r){u("#filter-rooms .ui-slider-handle:eq(0) span").text(r.values[0]),u("#filter-rooms .ui-slider-handle:eq(1) span").text(r.values[1])},stop:n}),i=o("FloorNumber"),a.$floors.slider({range:!0,min:i[0],max:i[1],values:[i[0],i[1]],create:function(e,r){u("#filter-floors .ui-slider-handle:eq(0)").append("<span>"+i[0]+"</span>"),u("#filter-floors .ui-slider-handle:eq(1)").append("<span>"+i[1]+"</span>")},slide:function(e,r){u("#filter-floors .ui-slider-handle:eq(0) span").text(r.values[0]),u("#filter-floors .ui-slider-handle:eq(1) span").text(r.values[1])},stop:n}),t=o("TotalArea"),t=[Math.floor(t[0]),Math.ceil(t[1])],a.$square.slider({range:!0,min:t[0],max:t[1],values:[t[0],t[1]],create:function(e,r){u("#filter-square .ui-slider-handle:eq(0)").append("<span>"+t[0]+"</span>"),u("#filter-square .ui-slider-handle:eq(1)").append("<span>"+t[1]+"</span>")},slide:function(e,r){u("#filter-square .ui-slider-handle:eq(0) span").text(r.values[0]),u("#filter-square .ui-slider-handle:eq(1) span").text(r.values[1])},stop:n}),s=o("Price"),a.$price.slider({range:!0,min:s[0],max:s[1],step:100,values:[s[0],s[1]],create:function(e,r){u("#filter-price-value").text(Number(s[0]).toLocaleString("ru-RU")+" — "+Number(s[1]).toLocaleString("ru-RU")+" руб.")},slide:function(e,r){u("#filter-price-value").text(Number(r.values[0]).toLocaleString("ru-RU")+" — "+Number(r.values[1]).toLocaleString("ru-RU")+" руб.")},stop:n}),setTimeout(function(){n()},100)},error:function(){}})}function n(){a.flatsArrayFiltered=a.flatsArray.filter(function(e){var r=e.FlatRoomsCount;if("string"==typeof r&&(r=1),r>=a.$rooms.slider("values",0)&&r<=a.$rooms.slider("values",1)&&e.FloorNumber>=a.$floors.slider("values",0)&&e.FloorNumber<=a.$floors.slider("values",1)&&e.TotalArea>=a.$square.slider("values",0)&&e.TotalArea<=a.$square.slider("values",1)&&e.Price>=a.$price.slider("values",0)&&e.Price<=a.$price.slider("values",1))return!0}),function(){var l="";a.flatsArrayFiltered.forEach(function(e){var r="";e.Action&&(r=" i-action"),l+='<tr class="modal-trigger'+r+'" data-url="'+e.URL+'" ><td>'+e.FloorNumber+" этаж<br></td><td>"+e.TotalArea+"м<sup>2</sup></td><td>"+e.FlatRoomsCount+"</td><td><b>"+e.PriceFormat+' руб.</b></td><td><a href="'+a.$tbody.data("orderlink")+e.ExternalId+'" class="btn">Оставить заявку</a></td></tr>'}),a.$tbody.html(l)}()}a.flatsArray=[],a.flatsArrayFiltered=[],a.$filter=u(".b-filter"),a.$tbody=u(".b-filter table tbody"),a.$reset=u("#filter-reset"),a.$rooms=u("#filter-rooms"),a.$floors=u("#filter-floors"),a.$square=u("#filter-square"),a.$price=u("#filter-price"),e(),a.slideFilter=n,a.setValue=r,a.$filter.delegate(".btn","click",function(e){e.stopPropagation()})}(u("#filter"))}),u("#filter-btn").click(function(e){e.preventDefault(),u("#filter-btn span:visible").is(".i-show")?(u("#filter").slideDown(),u("#filter-btn span").show(),u("#filter-btn span.i-show").hide()):(u("#filter").slideUp(),u("#filter-btn span").hide(),u("#filter-btn span.i-show").show())}),u(".b-filter .col.xl9").niceScroll()})}(jQuery);